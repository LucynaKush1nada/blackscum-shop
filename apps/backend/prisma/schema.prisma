generator client {
	provider = "prisma-client-js"
}

datasource db {
	provider = "postgresql"
	url      = env("DATABASE_URL")
}

model User {
	id               String   @id @default(cuid())
	telegramUserId   BigInt   @unique
	username         String?  @db.VarChar(64)
	name             String?
	phone            String?  @db.VarChar(32)
	createdAt        DateTime @default(now())
	updatedAt        DateTime @updatedAt
	orders           Order[]
	carts            Cart[]
}

model Product {
	id          String           @id @default(cuid())
	title       String
	slug        String           @unique
	description String?
	images      Json?
	category    String?
	active      Boolean          @default(true)
	variants    ProductVariant[]
	createdAt   DateTime         @default(now())
	updatedAt   DateTime         @updatedAt
}

model ProductVariant {
	id         String   @id @default(cuid())
	product   Product  @relation(fields: [productId], references: [id])
	productId String
	sku       String   @unique
	size      String?
	color     String?
	price     Int
	stock     Int      @default(0)
	limitPerUser Int?  @default(0)
	createdAt DateTime @default(now())
	updatedAt DateTime @updatedAt
	orderItems OrderItem[]
	cartItems  CartItem[]
}

model Cart {
	id        String    @id @default(cuid())
	user     User      @relation(fields: [userId], references: [id])
	userId   String
	items    CartItem[]
	createdAt DateTime @default(now())
	updatedAt DateTime @updatedAt
}

model CartItem {
	id        String         @id @default(cuid())
	cart      Cart           @relation(fields: [cartId], references: [id])
	cartId    String
	variant   ProductVariant @relation(fields: [variantId], references: [id])
	variantId String
	qty       Int            @default(1)
}

model Order {
	id           String     @id @default(cuid())
	user        User       @relation(fields: [userId], references: [id])
	userId      String
	total       Int
	currency    String      @default("RUB")
	status      String      @default("created")
	shippingAddress Json?
	shippingMethod  String?
	paymentProvider String?
	paymentPayload  Json?
	trackingCode    String?
	createdAt   DateTime   @default(now())
	updatedAt   DateTime   @updatedAt
	items       OrderItem[]
}

model OrderItem {
	id        String         @id @default(cuid())
	order     Order          @relation(fields: [orderId], references: [id])
	orderId   String
	variant   ProductVariant @relation(fields: [variantId], references: [id])
	variantId String
	price     Int
	qty       Int            @default(1)
}


